(self.webpackChunkPhysic=self.webpackChunkPhysic||[]).push([[13624],{13624:function(e,t,i){"use strict";i.d(t,{Mm:function(){return O},xM:function(){return U}});var s=i(46700),n=i(55679),r=i(35366),o=i(48400),a=i(64762),l=i(40878),c=i(44019),p=i(79996),m=i(90611),u=i(44689),d=i(11520),h=i(83588),g=i(61116),b=i(31041);function v(e,t){if(1&e&&(r.TgZ(0,"h4"),r._uU(1),r.ALo(2,"abpLocalization"),r.qZA()),2&e){const e=r.oxw().ngIf;r.xp6(1),r.AsE(" ",r.lcZ(2,2,"AbpPermissionManagement::Permissions")," - ",e.entityName," ")}}function f(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"a",22),r.NdJ("click",function(){r.CHM(e);const t=r.oxw().$implicit;return r.oxw(3).onChangeGroup(t)}),r.TgZ(1,"div"),r._uU(2),r.TgZ(3,"span"),r._uU(4),r.qZA(),r.qZA(),r.qZA()}if(2&e){const e=t.ngIf,i=r.oxw().$implicit,s=r.oxw(3);r.ekj("active",(null==s.selectedGroup?null:s.selectedGroup.name)===(null==i?null:i.name)),r.xp6(1),r.ekj("font-weight-bold",e.assignedCount),r.xp6(1),r.hij(" ",null==i?null:i.displayName," "),r.xp6(2),r.hij("(",e.assignedCount,")")}}const y=function(e){return{assignedCount:e}};function x(e,t){if(1&e&&(r.TgZ(0,"li",20),r.YNc(1,f,5,6,"a",21),r.qZA()),2&e){const e=t.$implicit,i=r.oxw(3);r.xp6(1),r.Q6J("ngIf",r.VKq(1,y,i.getAssignedCount(e.name)))}}function T(e,t){if(1&e&&(r.TgZ(0,"span",28),r._uU(1),r.qZA()),2&e){const e=t.$implicit;r.xp6(1),r.AsE("",e.providerName,": ",e.providerKey,"")}}function k(e,t){if(1&e&&(r.ynx(0),r.YNc(1,T,2,2,"span",27),r.BQk()),2&e){const e=r.oxw().$implicit;r.xp6(1),r.Q6J("ngForOf",e.grantedProviders)}}function Z(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"div",23),r._UZ(1,"input",24,25),r.TgZ(3,"label",26),r.NdJ("click",function(){const t=r.CHM(e).$implicit,i=r.MAs(2);return r.oxw(3).onClickCheckbox(t,i.value)}),r._uU(4),r.YNc(5,k,2,1,"ng-container",1),r.qZA(),r.qZA()}if(2&e){const e=t.$implicit,i=r.oxw(3);r.Q6J("ngStyle",e.style),r.xp6(1),r.Q6J("checked",i.getChecked(e.name))("value",i.getChecked(e.name))("disabled",i.isGrantedByOtherProviderName(e.grantedProviders)),r.uIk("id",e.name),r.xp6(2),r.uIk("for",e.name),r.xp6(1),r.hij("",e.displayName," "),r.xp6(1),r.Q6J("ngIf",!i.hideBadges)}}function A(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"div",5),r.TgZ(1,"input",6),r.NdJ("ngModelChange",function(t){return r.CHM(e),r.oxw(2).selectAllTab=t})("click",function(){return r.CHM(e),r.oxw(2).onClickSelectAll()}),r.qZA(),r.TgZ(2,"label",7),r._uU(3),r.ALo(4,"abpLocalization"),r.qZA(),r.qZA(),r._UZ(5,"hr",8),r.TgZ(6,"div",9),r.TgZ(7,"div",10),r.TgZ(8,"ul",11),r.YNc(9,x,2,3,"li",12),r.ALo(10,"async"),r.qZA(),r.qZA(),r.TgZ(11,"div",13),r.TgZ(12,"h4"),r._uU(13),r.qZA(),r._UZ(14,"hr",14),r.TgZ(15,"div",15),r.TgZ(16,"div",5),r.TgZ(17,"input",16),r.NdJ("ngModelChange",function(t){return r.CHM(e),r.oxw(2).selectThisTab=t})("click",function(){return r.CHM(e),r.oxw(2).onClickSelectThisTab()}),r.qZA(),r.TgZ(18,"label",17),r._uU(19),r.ALo(20,"abpLocalization"),r.qZA(),r.qZA(),r._UZ(21,"hr",18),r.YNc(22,Z,6,8,"div",19),r.ALo(23,"async"),r.qZA(),r.qZA(),r.qZA()}if(2&e){const e=r.oxw(2);r.xp6(1),r.Q6J("ngModel",e.selectAllTab),r.xp6(2),r.Oqu(r.lcZ(4,9,"AbpPermissionManagement::SelectAllInAllTabs")),r.xp6(6),r.Q6J("ngForOf",r.lcZ(10,11,e.groups$))("ngForTrackBy",e.trackByFn),r.xp6(4),r.Oqu(null==e.selectedGroup?null:e.selectedGroup.displayName),r.xp6(4),r.Q6J("ngModel",e.selectThisTab),r.xp6(2),r.Oqu(r.lcZ(20,13,"AbpPermissionManagement::SelectAllInThisTab")),r.xp6(3),r.Q6J("ngForOf",r.lcZ(23,15,e.selectedGroupPermissions$))("ngForTrackBy",e.trackByFn)}}function N(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"button",29,30),r._uU(2),r.ALo(3,"abpLocalization"),r.qZA(),r.TgZ(4,"abp-button",31),r.NdJ("click",function(){return r.CHM(e),r.oxw(2).submit()}),r._uU(5),r.ALo(6,"abpLocalization"),r.qZA()}2&e&&(r.xp6(2),r.hij(" ",r.lcZ(3,2,"AbpIdentity::Cancel")," "),r.xp6(3),r.Oqu(r.lcZ(6,4,"AbpIdentity::Save")))}function C(e,t){1&e&&(r.ynx(0),r.YNc(1,v,3,4,"ng-template",null,2,r.W1O),r.YNc(3,A,24,17,"ng-template",null,3,r.W1O),r.YNc(5,N,7,6,"ng-template",null,4,r.W1O),r.BQk())}const G=function(e){return{entityName:e}};let P=(()=>{class e{constructor(e){this.payload=e}}return e.type="[PermissionManagement] Get Permissions",e})(),M=(()=>{class e{constructor(e){this.payload=e}}return e.type="[PermissionManagement] Update Permissions",e})(),q=(()=>{class e{constructor(e){this.restService=e,this.apiName="AbpPermissionManagement",this.get=(e,t)=>this.restService.request({method:"GET",url:"/api/permission-management/permissions",params:{providerName:e,providerKey:t}},{apiName:this.apiName}),this.update=(e,t,i)=>this.restService.request({method:"PUT",url:"/api/permission-management/permissions",params:{providerName:e,providerKey:t},body:i},{apiName:this.apiName})}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(s.vgb))},e.\u0275prov=(0,r.Yz7)({factory:function(){return new e((0,r.LFG)(s.vgb))},token:e,providedIn:"root"}),e})(),w=(()=>{let e=class{constructor(e){this.service=e}static getPermissionGroups({permissionRes:e}){return e.groups||[]}static getEntityDisplayName({permissionRes:e}){return e.entityDisplayName}permissionManagementGet({patchState:e},{payload:{providerKey:t,providerName:i}={}}){return this.service.get(i,t).pipe((0,c.b)(t=>e({permissionRes:t})))}permissionManagementUpdate(e,{payload:t}){return this.service.update(t.providerName,t.providerKey,{permissions:t.permissions})}};return e.\u0275fac=function(t){return new(t||e)(r.LFG(q))},e.\u0275prov=r.Yz7({token:e,factory:function(t){return e.\u0275fac(t)}}),(0,a.gn)([(0,o.aU)(P)],e.prototype,"permissionManagementGet",null),(0,a.gn)([(0,o.aU)(M)],e.prototype,"permissionManagementUpdate",null),(0,a.gn)([(0,o.Qf)()],e,"getPermissionGroups",null),(0,a.gn)([(0,o.Qf)()],e,"getEntityDisplayName",null),e=(0,a.gn)([(0,o.ZM)({name:"PermissionManagementState",defaults:{permissionRes:{}}})],e),e})(),O=(()=>{class e{constructor(e,t,i){this.store=e,this.configState=t,this.appConfigService=i,this.hideBadges=!1,this._visible=!1,this.visibleChange=new r.vpe,this.permissions=[],this.selectThisTab=!1,this.selectAllTab=!1,this.modalBusy=!1,this.trackByFn=(e,t)=>t.name}get visible(){return this._visible}set visible(e){e!==this._visible&&(e?this.openModal().subscribe(()=>{this._visible=!0,this.visibleChange.emit(!0)}):(this.selectedGroup=null,this._visible=!1,this.visibleChange.emit(!1)))}get selectedGroupPermissions$(){const e=`margin-${"rtl"===document.body.dir?"right":"left"}.px`;return this.groups$.pipe((0,p.U)(e=>this.selectedGroup?e.find(e=>e.name===this.selectedGroup.name).permissions:[]),(0,p.U)(t=>t.map(i=>Object.assign(Object.assign({},i),{style:{[e]:S(t,i)},isGranted:this.permissions.find(e=>e.name===i.name).isGranted}))))}getChecked(e){return(this.permissions.find(t=>t.name===e)||{isGranted:!1}).isGranted}isGrantedByOtherProviderName(e){return!!e.length&&e.findIndex(e=>e.providerName!==this.providerName)>-1}onClickCheckbox(e,t){e.isGranted&&this.isGrantedByOtherProviderName(e.grantedProviders)||setTimeout(()=>{this.permissions=this.permissions.map(t=>e.name===t.name?Object.assign(Object.assign({},t),{isGranted:!t.isGranted}):e.name===t.parentName&&e.isGranted?Object.assign(Object.assign({},t),{isGranted:!1}):e.parentName!==t.name||e.isGranted?t:Object.assign(Object.assign({},t),{isGranted:!0})),this.setTabCheckboxState(),this.setGrantCheckboxState()},0)}setTabCheckboxState(){this.selectedGroupPermissions$.pipe((0,m.q)(1)).subscribe(e=>{const t=e.filter(e=>e.isGranted),i=document.querySelector("#select-all-in-this-tabs");t.length===e.length?(i.indeterminate=!1,this.selectThisTab=!0):0===t.length?(i.indeterminate=!1,this.selectThisTab=!1):i.indeterminate=!0})}setGrantCheckboxState(){const e=this.permissions.filter(e=>e.isGranted),t=document.querySelector("#select-all-in-all-tabs");e.length===this.permissions.length?(t.indeterminate=!1,this.selectAllTab=!0):0===e.length?(t.indeterminate=!1,this.selectAllTab=!1):t.indeterminate=!0}onClickSelectThisTab(){this.selectedGroupPermissions$.pipe((0,m.q)(1)).subscribe(e=>{e.forEach(e=>{if(e.isGranted&&this.isGrantedByOtherProviderName(e.grantedProviders))return;const t=this.permissions.findIndex(t=>t.name===e.name);this.permissions=[...this.permissions.slice(0,t),Object.assign(Object.assign({},this.permissions[t]),{isGranted:!this.selectThisTab}),...this.permissions.slice(t+1)]})}),this.setGrantCheckboxState()}onClickSelectAll(){this.permissions=this.permissions.map(e=>Object.assign(Object.assign({},e),{isGranted:this.isGrantedByOtherProviderName(e.grantedProviders)||!this.selectAllTab})),this.selectThisTab=!this.selectAllTab}onChangeGroup(e){this.selectedGroup=e,this.setTabCheckboxState()}submit(){const e=F(this.store.selectSnapshot(w.getPermissionGroups)),t=this.permissions.filter(t=>e.find(e=>e.name===t.name).isGranted!==t.isGranted).map(({name:e,isGranted:t})=>({name:e,isGranted:t}));t.length?(this.modalBusy=!0,this.store.dispatch(new M({providerKey:this.providerKey,providerName:this.providerName,permissions:t})).pipe((0,u.w)(()=>this.shouldFetchAppConfig()?this.appConfigService.get().pipe((0,c.b)(e=>this.configState.setState(e))):(0,l.of)(null)),(0,d.x)(()=>this.modalBusy=!1)).subscribe(()=>{this.visible=!1})):this.visible=!1}openModal(){if(!this.providerKey||!this.providerName)throw new Error("Provider Key and Provider Name are required.");return this.store.dispatch(new P({providerKey:this.providerKey,providerName:this.providerName})).pipe((0,h.j)("PermissionManagementState","permissionRes"),(0,c.b)(e=>{this.selectedGroup=e.groups[0],this.permissions=F(e.groups)}))}initModal(){this.setTabCheckboxState(),this.setGrantCheckboxState()}getAssignedCount(e){return this.permissions.reduce((t,i)=>i.name.split(".")[0]===e&&i.isGranted?t+1:t,0)}shouldFetchAppConfig(){const e=this.configState.getOne("currentUser");return"R"===this.providerName?e.roles.some(e=>e===this.providerKey):"U"===this.providerName&&e.id===this.providerKey}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(o.yh),r.Y36(s.XJE),r.Y36(s.xa_))},e.\u0275cmp=r.Xpm({type:e,selectors:[["abp-permission-management"]],inputs:{hideBadges:"hideBadges",visible:"visible",providerName:"providerName",providerKey:"providerKey"},outputs:{visibleChange:"visibleChange"},exportAs:["abpPermissionManagement"],decls:3,vars:7,consts:[[3,"visible","busy","visibleChange","init"],[4,"ngIf"],["abpHeader",""],["abpBody",""],["abpFooter",""],[1,"custom-checkbox","custom-control","mb-2"],["type","checkbox","id","select-all-in-all-tabs","name","select-all-in-all-tabs",1,"custom-control-input",3,"ngModel","ngModelChange","click"],["for","select-all-in-all-tabs",1,"custom-control-label"],[1,"mt-2","mb-2"],[1,"row"],[1,"overflow-scroll","col-md-4"],[1,"nav","nav-pills","flex-column"],["class","nav-item",4,"ngFor","ngForOf","ngForTrackBy"],[1,"col-md-8","overflow-scroll"],[1,"mt-2","mb-3"],[1,"pl-1","pt-1"],["type","checkbox","id","select-all-in-this-tabs","name","select-all-in-this-tabs",1,"custom-control-input",3,"ngModel","ngModelChange","click"],["for","select-all-in-this-tabs",1,"custom-control-label"],[1,"mb-3"],["class","custom-checkbox custom-control mb-2",3,"ngStyle",4,"ngFor","ngForOf","ngForTrackBy"],[1,"nav-item"],["class","nav-link pointer",3,"active","click",4,"ngIf"],[1,"nav-link","pointer",3,"click"],[1,"custom-checkbox","custom-control","mb-2",3,"ngStyle"],["type","checkbox",1,"custom-control-input",3,"checked","value","disabled"],["permissionCheckbox",""],[1,"custom-control-label",3,"click"],["class","badge badge-light",4,"ngFor","ngForOf"],[1,"badge","badge-light"],["type","button",1,"btn","btn-secondary"],["abpClose",""],["iconClass","fa fa-check",3,"click"]],template:function(e,t){1&e&&(r.TgZ(0,"abp-modal",0),r.NdJ("visibleChange",function(e){return t.visible=e})("init",function(){return t.initModal()}),r.YNc(1,C,7,0,"ng-container",1),r.ALo(2,"async"),r.qZA()),2&e&&(r.Q6J("visible",t.visible)("busy",t.modalBusy),r.xp6(1),r.Q6J("ngIf",r.VKq(5,G,r.lcZ(2,3,t.entityName$))))},directives:[n.zS,g.O5,b.Wl,b.JJ,b.On,g.sg,g.PC,n.r0],pipes:[g.Ov,s.fuE],styles:[".overflow-scroll[_ngcontent-%COMP%] {\n        max-height: 70vh;\n        overflow-y: scroll;\n      }"]}),(0,a.gn)([(0,o.Ph)(w.getPermissionGroups)],e.prototype,"groups$",void 0),(0,a.gn)([(0,o.Ph)(w.getEntityDisplayName)],e.prototype,"entityName$",void 0),e})();function S(e,t){const i=e.find(e=>e.name===t.parentName);if(i&&i.parentName){let t=20;return t+=S(e,i)}return i?20:0}function F(e){return e.reduce((e,t)=>[...e,...t.permissions],[])}let U=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.oAB({type:e}),e.\u0275inj=r.cJS({imports:[[s.IR2,n.e2,o.$l.forFeature([w])]]}),e})()},83588:function(e,t,i){"use strict";i.d(t,{j:function(){return n}});var s=i(79996);function n(...e){const t=e.length;if(0===t)throw new Error("list of properties cannot be empty.");return i=>(0,s.U)(function(e,t){return i=>{let s=i;for(let n=0;n<t;n++){const t=null!=s?s[e[n]]:void 0;if(void 0===t)return;s=t}return s}}(e,t))(i)}}}]);